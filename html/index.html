<!DOCTYPE html>
<html>
<head>
    <title>ML Prediction: Penguin Weight</title>
    <meta charset="utf-8">
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 500px; }
        label { display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 5px; }
        button { margin-top: 20px; padding: 10px; width: 100%; cursor: pointer; }
        #result { margin-top: 20px; font-weight: bold; color: #2c3e50; }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #0000ff">
            Infrastructure:
        </h2>
        <h2 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #0000ff">
            Provisioned via Terraform Managed Code
        </h2>
        <h2 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #34495e;">
            ML Prediction: <span style="font-size: 0.8em; color: #7f8c8d;">How heavy is that penguin?ğŸ§</span>
        </h2>
        <table>
            <tr>
                <td>
                    <div class="image-area">
                      <img id="target-image" src="Adelie.png" alt="Selected Penguin Image" style="width: 40%;">
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    Penguin Species: ãƒšãƒ³ã‚®ãƒ³ç¨®
                </td>
            </tr>
            <tr>
                <td>
                    <select id="species" onchange="changeImage()">
                        <option value="Adelie">Adelie: ã‚¢ãƒ‡ãƒªãƒ¼</option>
                        <option value="Chinstrap">Chinstrap: ãƒ’ã‚²</option>
                        <option value="Gentoo">Gentoo: ã‚¸ã‚§ãƒ³ãƒ„ãƒ¼</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Islands they live on: ç”Ÿæ¯ã™ã‚‹å³¶
                </td>
            </tr>
            <tr>
                <td>
                    <select id="island">
                        <option value="Torgersen">Torgersen</option>
                        <option value="Biscoe">Biscoe</option>
                        <option value="Dream">Dream</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Bill length(mm): ãã¡ã°ã—ã®é•·ã•
                </td>
            </tr>
            <tr>
                <td>
                    <input type="number" id="bill_l" value="50">
                </td>
            </tr>
            <tr>
                <td>
                    Bill Depth(mm): ãã¡ã°ã—ã®æ·±ã•
                </td>
            </tr>
            <tr>
                <td>
                    <input type="number" id="bill_d" value="20">
                </td>
            </tr>
            <tr>
                <td>
                    Flipper Lenght(mm): ç¾½ã®é•·ã•
                </td>
            </tr>
            <tr>
                <td>
                    <input type="number" id="flipper" value="200">
                </td>
            </tr>
            <tr>
                <td>
                    Sex: æ€§åˆ¥
                </td>
            </tr>
            <tr>
                <td>
                    <select id="sex">
                        <option value="MALE">Male: ã‚ªã‚¹</option>
                        <option value="FEMALE">Female: ãƒ¡ã‚¹</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <button onclick="predict()">Display Weight Prediction Below: ä½“é‡äºˆæ¸¬ã‚’ä¸‹ã«è¡¨ç¤º</button>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="result"></div>
                </td>
            </tr>
        </table>
    </div>

    <script>
        function changeImage() {
          const selector = document.getElementById('species');
          const image = document.getElementById('target-image');
  
          // é¸æŠã•ã‚ŒãŸvalueã®å€¤ã‚’imgã‚¿ã‚°ã®srcã«ä»£å…¥
          image.src = selector.value + ".png";
        }
        
        async function predict() {
            const resultDiv = document.getElementById('result');
            const url = "https://penguin2-api-528352551348.asia-northeast1.run.app/predict";
        
            // 1. ã€Œè¨ˆç®—ä¸­ã€ã®çŠ¶æ…‹ã«ã™ã‚‹
            resultDiv.innerText = "â³ äºˆæ¸¬è¨ˆç®—ä¸­...";
            resultDiv.style.color = "#2c3e50"; // é€šå¸¸ã®è‰²ã«æˆ»ã™
        
            const data = {
                species: document.getElementById('species').value,
                island: document.getElementById('island').value,
                bill_length_mm: parseFloat(document.getElementById('bill_l').value),
                bill_depth_mm: parseFloat(document.getElementById('bill_d').value),
                flipper_length_mm: parseFloat(document.getElementById('flipper').value),
                sex: document.getElementById('sex').value
            };

            try {
                // 2. APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ­£å¸¸ï¼ˆ200 OKï¼‰ã§ãªã„å ´åˆ
                if (!res.ok) {
                    throw new Error(`APIã‚¨ãƒ©ãƒ¼: ${res.status} ${res.statusText}`);
                }
        
                const result = await res.json();
        
                // 3. æˆåŠŸæ™‚ã®è¡¨ç¤º
                resultDiv.innerText = "âœ… äºˆæ¸¬ä½“é‡: " + Math.round(result.predicted_body_mass_g) + " g";

            } catch (error) {
                // 4. ã‚¨ãƒ©ãƒ¼æ™‚ã®è¡¨ç¤º
                console.error("Error details:", error);
                resultDiv.innerText = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message;
                resultDiv.style.color = "red"; // ã‚¨ãƒ©ãƒ¼ã¯èµ¤å­—ã§ç›®ç«‹ãŸã›ã‚‹
            }
        }
    </script>
</body>
</html>